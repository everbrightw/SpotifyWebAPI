{"ast":null,"code":"import _regeneratorRuntime from\"/Users/yusenwang/cs498rk/mp2/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/yusenwang/cs498rk/mp2/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/yusenwang/cs498rk/mp2/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/yusenwang/cs498rk/mp2/node_modules/@babel/runtime/helpers/esm/createClass\";import axios from'axios';import qs from'querystring';var client_id=\"c64550a797cb4fc9931f45b4ca0e8c21\";var client_secret=\"7c4d4382f48a40168a04273de0b91183\";var ONE_HOUR=60*60*1000;var Utils=/*#__PURE__*/function(){function Utils(){_classCallCheck(this,Utils);}_createClass(Utils,[{key:\"getAuthToken\",value:function(){var _getAuthToken=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var AUTH_TOKEN_KEY,LAST_AUTH_TIME_KEY,authToken,lastAuthTime,isExpired,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:AUTH_TOKEN_KEY='auth-token';LAST_AUTH_TIME_KEY='last-auth-time';authToken=localStorage.getItem(AUTH_TOKEN_KEY);lastAuthTime=new Date(localStorage.getItem(LAST_AUTH_TIME_KEY));isExpired=new Date()-lastAuthTime>=ONE_HOUR;if(!(!authToken||isExpired)){_context.next=12;break;}_context.next=8;return this.authenticate();case 8:data=_context.sent;authToken=data.access_token;localStorage.setItem(AUTH_TOKEN_KEY,authToken);localStorage.setItem(LAST_AUTH_TIME_KEY,new Date().toISOString());case 12:return _context.abrupt(\"return\",authToken);case 13:case\"end\":return _context.stop();}}},_callee,this);}));function getAuthToken(){return _getAuthToken.apply(this,arguments);}return getAuthToken;}()},{key:\"authenticate\",value:function(){var _authenticate=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var basicToken,res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:basicToken=new Buffer(\"\".concat(client_id,\":\").concat(client_secret)).toString('base64');_context2.next=3;return axios.post('https://accounts.spotify.com/api/token',qs.stringify({grant_type:'client_credentials'}),{headers:{'Content-Type':'application/x-www-form-urlencoded',Authorization:'Basic '+basicToken}});case 3:res=_context2.sent;return _context2.abrupt(\"return\",res.data);case 5:case\"end\":return _context2.stop();}}},_callee2);}));function authenticate(){return _authenticate.apply(this,arguments);}return authenticate;}()},{key:\"getConfig\",value:function(){var _getConfig=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var auth_token,config;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return this.getAuthToken();case 2:auth_token=_context3.sent;config={headers:{'Content-Type':'application/json','Authorization':\"Bearer \"+auth_token}};return _context3.abrupt(\"return\",config);case 5:case\"end\":return _context3.stop();}}},_callee3,this);}));function getConfig(){return _getConfig.apply(this,arguments);}return getConfig;}()}]);return Utils;}();export var utils=new Utils();","map":{"version":3,"sources":["/Users/yusenwang/cs498rk/mp2/src/Utils.js"],"names":["axios","qs","client_id","client_secret","ONE_HOUR","Utils","AUTH_TOKEN_KEY","LAST_AUTH_TIME_KEY","authToken","localStorage","getItem","lastAuthTime","Date","isExpired","authenticate","data","access_token","setItem","toISOString","basicToken","Buffer","toString","post","stringify","grant_type","headers","Authorization","res","getAuthToken","auth_token","config","utils"],"mappings":"ubAAA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CACA,MAAOC,CAAAA,EAAP,KAAe,aAAf,CAGA,GAAMC,CAAAA,SAAS,CAAG,kCAAlB,CACA,GAAMC,CAAAA,aAAa,CAAG,kCAAtB,CACA,GAAMC,CAAAA,QAAQ,CAAG,GAAK,EAAL,CAAU,IAA3B,C,GAEMC,CAAAA,K,yZAIQC,c,CAAiB,Y,CACjBC,kB,CAAqB,gB,CACvBC,S,CAAYC,YAAY,CAACC,OAAb,CAAqBJ,cAArB,C,CACZK,Y,CAAe,GAAIC,CAAAA,IAAJ,CAASH,YAAY,CAACC,OAAb,CAAqBH,kBAArB,CAAT,C,CACfM,S,CAAY,GAAID,CAAAA,IAAJ,GAAaD,YAAb,EAA6BP,Q,MAEzC,CAACI,SAAD,EAAcK,S,iDACC,MAAKC,YAAL,E,QAAbC,I,eACJP,SAAS,CAAGO,IAAI,CAACC,YAAjB,CACAP,YAAY,CAACQ,OAAb,CAAqBX,cAArB,CAAqCE,SAArC,EACAC,YAAY,CAACQ,OAAb,CAAqBV,kBAArB,CAAyC,GAAIK,CAAAA,IAAJ,GAAWM,WAAX,EAAzC,E,wCAIKV,S,waAKHW,U,CAAa,GAAIC,CAAAA,MAAJ,WAAclB,SAAd,aAA2BC,aAA3B,GAA4CkB,QAA5C,CAAqD,QAArD,C,wBACDrB,CAAAA,KAAK,CAACsB,IAAN,CACd,wCADc,CAEdrB,EAAE,CAACsB,SAAH,CAAa,CAAEC,UAAU,CAAE,oBAAd,CAAb,CAFc,CAGd,CACEC,OAAO,CAAE,CACP,eAAgB,mCADT,CAEPC,aAAa,CAAE,SAAWP,UAFnB,CADX,CAHc,C,QAAZQ,G,iDAWGA,GAAG,CAACZ,I,wbAMY,MAAKa,YAAL,E,QAAnBC,U,gBACAC,M,CAAS,CACTL,OAAO,CAAE,CACL,eAAgB,kBADX,CAEL,gBAAiB,UAAWI,UAFvB,CADA,C,kCAMNC,M,yKAKf,MAAO,IAAMC,CAAAA,KAAK,CAAG,GAAI1B,CAAAA,KAAJ,EAAd","sourcesContent":["import axios from 'axios'\nimport qs from 'querystring'\n\n\nconst client_id = \"c64550a797cb4fc9931f45b4ca0e8c21\";\nconst client_secret = \"7c4d4382f48a40168a04273de0b91183\";\nconst ONE_HOUR = 60 * 60 * 1000\n\nclass Utils{\n\n    \n    async getAuthToken() {\n        const AUTH_TOKEN_KEY = 'auth-token'\n        const LAST_AUTH_TIME_KEY = 'last-auth-time'\n        let authToken = localStorage.getItem(AUTH_TOKEN_KEY)\n        let lastAuthTime = new Date(localStorage.getItem(LAST_AUTH_TIME_KEY))\n        let isExpired = new Date() - lastAuthTime >= ONE_HOUR\n    \n        if (!authToken || isExpired) {\n          let data = await this.authenticate()\n          authToken = data.access_token\n          localStorage.setItem(AUTH_TOKEN_KEY, authToken)\n          localStorage.setItem(LAST_AUTH_TIME_KEY, new Date().toISOString())\n        }\n    \n        // console.log('authToken', authToken)\n        return authToken\n    }\n\n    async authenticate() {\n\n        let basicToken = new Buffer(`${client_id}:${client_secret}`).toString('base64')\n        let res = await axios.post(\n          'https://accounts.spotify.com/api/token',\n          qs.stringify({ grant_type: 'client_credentials' }),\n          {\n            headers: {\n              'Content-Type': 'application/x-www-form-urlencoded',\n              Authorization: 'Basic ' + basicToken\n            }\n          }\n        )\n    \n        return res.data\n    }\n\n\n    async getConfig(){\n        \n        let auth_token = await this.getAuthToken();\n        let config = {\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': \"Bearer \"+ auth_token\n            }\n        }\n        return config;\n    }\n\n}\n\nexport const utils = new Utils()"]},"metadata":{},"sourceType":"module"}